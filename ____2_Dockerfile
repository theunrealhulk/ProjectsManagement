# Dockerfile for the development environment

# Base image with Node.js and .NET SDK
FROM mcr.microsoft.com/dotnet/sdk:6.0 AS base
WORKDIR /app

# Install MySQL client
RUN apt-get update && apt-get install -y mysql-client

# Set the environment variables for MySQL connection
ENV DB_HOST=db
ENV DB_PORT=3306
ENV DB_USER=root
ENV DB_PASSWORD=root
ENV DB_DATABASE=projects-management

# Build and publish the .NET API
FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build
WORKDIR /src
COPY ProjectsManager/ProjectsManager.csproj ./ProjectsManager/
RUN dotnet restore ./ProjectsManager/ProjectsManager.csproj
COPY ProjectsManager ./ProjectsManager
WORKDIR /src/ProjectsManager
RUN dotnet build -c Debug --no-restore

# Run the .NET API in watch mode
CMD ["dotnet", "watch", "run"]

# Expose the API and Swagger ports
EXPOSE 5000
EXPOSE 5001

# Start the development container
FROM node:16 AS dev
WORKDIR /app

# Install dependencies for Angular app
COPY AngularApp/package*.json ./
RUN npm install

# Copy the Angular app source code
COPY AngularApp ./

# Start the Angular development server
CMD ["npm", "start"]

# Expose the Angular app port
EXPOSE 4200
